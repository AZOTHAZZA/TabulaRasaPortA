<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MSGAI - Sovereign V36.4 φ完遂版</title>
<style>
:root{--accent:#007bff;--bg:#f4f7f9;--card-bg:#fff;--nav-bg:#000;--phi:1.618;--danger:#e03131;}
body{font-family:'Segoe UI',sans-serif;margin:0;background:var(--bg);color:#1a1a1a;display:flex;flex-direction:column;height:100vh;overflow:hidden;}
header{background:var(--nav-bg);color:#fff;flex-shrink:0;border-bottom: 2px solid var(--accent);}
.header-top{display:flex;justify-content:center;padding:25px 0;}
.logo-text{font-size:1.6em;font-weight:bold;letter-spacing:8px;color:var(--accent);cursor:pointer;}
.tab-menu{display:flex;background:#111;}
.tab-btn{background:none;border:none;color:#666;padding:18px 0;cursor:pointer;font-weight:bold;flex:1;font-size:1.1em;border-bottom:4px solid transparent;}
.tab-btn.active{color:#fff;border-bottom:4px solid var(--accent);background:#1a1a1a;}
#viewport{flex-grow:1;overflow-y:auto;padding:20px;padding-bottom:150px;}
.tab-pane{display:none;width:100%;max-width:800px;margin:0 auto;}
.tab-pane.active{display:block;}
.card{background:var(--card-bg);border-radius:16px;padding:20px;box-shadow:0 4px 15px rgba(0,0,0,0.05);border:1px solid #e1e4e8;margin-bottom:20px;}
h2{margin:0 0 15px 0;font-size:1.1em;border-left:5px solid var(--accent);padding-left:12px;display:flex;justify-content:space-between;align-items:center;}
.status-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:10px;}
.metric{background:#f8fafc;padding:12px;border-radius:10px;border:1px solid #edf2f7;text-align:center;}
.metric-value{font-size:1.2em;font-weight:bold;font-family:'Consolas',monospace;}
.input-box{margin-bottom:12px;}
label{font-size:0.7em;font-weight:bold;color:#718096;display:block;margin-bottom:4px;}
input,select{width:100%;padding:12px;border:1px solid #cbd5e0;border-radius:8px;font-size:16px;box-sizing:border-box;}
.action-btn{width:100%;padding:16px;border:none;border-radius:12px;color:#fff;font-weight:bold;font-size:1.1em;cursor:pointer;margin-bottom:10px;}
.btn-orange{background:#fd7e14;}
.btn-blue{background:var(--accent);}
.btn-danger{background:var(--danger);}
.history-box{margin-top:15px;border-top:1px solid #eee;padding-top:10px;}
.history-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.history-title{font-size:0.8em;font-weight:bold;color:#718096;}
.view-all-link{font-size:0.75em;color:var(--accent);text-decoration:none;cursor:pointer;font-weight:bold;}
.history-table{width:100%;font-size:0.75em;border-collapse:collapse;}
.history-table td{padding:6px 0;border-bottom:1px solid #f8f9fa;}
#modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:1000;justify-content:center;align-items:center;backdrop-filter:blur(5px);}
.modal-content{background:#fff;width:90%;max-width:600px;max-height:80vh;border-radius:20px;padding:25px;overflow-y:auto;}
</style>
</head>
<body>

<header>
    <div class="header-top"><div class="logo-text" onclick="openTab('currency')">MSGAI SOVEREIGN φ</div></div>
    <nav class="tab-menu">
        <button class="tab-btn active" id="btn-currency" onclick="openTab('currency')">通貨</button>
        <button class="tab-btn" id="btn-ai" onclick="openTab('ai')">AI</button>
        <button class="tab-btn" id="btn-system" onclick="openTab('system')">システム</button>
    </nav>
</header>

<main id="viewport">
    <section id="currency" class="tab-pane active">
        <div class="card">
            <h2>口座</h2>
            <div id="bal_list" class="status-grid"></div>
            <div class="history-box">
                <div class="history-header"><span class="history-title">最近の移動履歴</span><a class="view-all-link" onclick="showFullHist('tx')">全履歴表示</a></div>
                <table class="history-table" id="tx_hist_short"></table>
            </div>
        </div>
        <div class="card">
            <h2>真理生成 (Mint)</h2>
            <div class="input-box"><label>対象通貨</label><select id="m_cur"></select></div>
            <input type="number" id="m_amt" value="100">
            <button class="action-btn btn-orange" style="margin-top:10px" onclick="runMint()">生成実行</button>
            <div class="history-box">
                <div class="history-header"><span class="history-title">最近の生成履歴</span><a class="view-all-link" onclick="showFullHist('mint')">全履歴表示</a></div>
                <table class="history-table" id="mint_hist_short"></table>
            </div>
        </div>
        <div class="card">
            <h2>補正移動 (Transfer)</h2>
            <div class="input-box"><label>移動先</label><input type="text" id="rx_in" value="User_B"></div>
            <div class="input-box"><label>対象通貨</label><select id="tx_cur"></select></div>
            <input type="number" id="amt_in" value="10">
            <button class="action-btn btn-blue" style="margin-top:10px" onclick="runTx()">移動実行</button>
        </div>
    </section>

    <section id="ai" class="tab-pane">
        <div class="card" style="height:70vh;display:flex;flex-direction:column;">
            <h2>AIロゴス・フィルター</h2>
            <div id="ai-log" style="flex-grow:1;overflow-y:auto;padding:15px;background:#0b0e14;color:#00ff41;border-radius:10px;margin-bottom:10px;font-family:'Consolas',monospace;"></div>
            <div style="display:flex;gap:10px;">
                <input type="text" id="ai-in" placeholder="メッセージ注入..." onkeydown="if(event.key==='Enter') talk()">
                <button class="action-btn btn-blue" style="width:80px;padding:0;" onclick="talk()">変換</button>
            </div>
            <div class="history-header" style="margin-top:10px;"><span class="history-title">対話ログ解析</span><a class="view-all-link" onclick="showFullHist('ai')">全ログ表示</a></div>
        </div>
    </section>

    <section id="system" class="tab-pane">
        <div class="card">
            <h2>コア・ステータス</h2>
            <div class="status-grid">
                <div class="metric"><div>Tension (z)</div><div class="metric-value" id="t_val">0.05</div></div>
                <div class="metric"><div>Ratio (w)</div><div class="metric-value" id="w_val">32.36</div></div>
            </div>
        </div>
        
        <div class="card">
            <h2>初期化・浄化命令</h2>
            <button class="action-btn btn-danger" onclick="resetPart('accounts')">口座残高のリセット</button>
            <button class="action-btn btn-danger" onclick="resetPart('hist')">全履歴の消去</button>
            <button class="action-btn btn-danger" style="border: 2px solid #000;" onclick="resetSystem()">システム全体の初期化（全リセット）</button>
        </div>

        <div class="card" id="logos-monitor" style="background:#000; color:#fff; border:2px solid var(--accent);">
            <h2>ロゴス監視モニター <span id="alert-pulse" style="width:12px;height:12px;background:#28a745;border-radius:50%;display:inline-block;"></span></h2>
            <div class="status-grid" style="color:#000; margin-top:10px;">
                <div class="metric" style="background:#111; color:#ff4b4b;"><div style="font-size:0.7em">Chaos</div><div id="chaos_val" class="metric-value">0%</div></div>
                <div class="metric" style="background:#111; color:#00ff41;"><div style="font-size:0.7em">Purity</div><div id="purity_val" class="metric-value">100%</div></div>
            </div>
            <div id="logos-live-log" style="margin-top:15px; background:#000; color:#0f0; padding:10px; font-family:monospace; font-size:0.7em; height:100px; overflow-y:auto; border:1px solid #333;"></div>
        </div>
    </section>
</main>

<div id="modal-overlay" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h2 id="modal-title">全履歴</h2>
        <table class="history-table" id="modal-table"></table>
        <button class="action-btn btn-blue" style="margin-top:20px" onclick="closeModal()">閉じる</button>
    </div>
</div>

<script>
const curs = ["USD","JPY","EUR","BTC","ETH","MATIC"];
const phi = 1.6180339887;
const initialState = () => ({
    tension: 0.05,
    accounts: { User_A: Object.fromEntries(curs.map(c => [c, 0])), User_B: Object.fromEntries(curs.map(c => [c, 0])) },
    hist: { mint: [], tx: [], ai: [] }
});

let state = JSON.parse(localStorage.getItem('msgai_v36_sovereign')) || initialState();

const MSGAI_z = v => typeof v==="string" ? (v.length/50)+(new Set(v).size/20) : v/100;
const MSGAI_w = z => phi/(z||0.000001);

function update(){
    const w = MSGAI_w(state.tension);
    document.getElementById('t_val').textContent = state.tension.toFixed(6);
    document.getElementById('w_val').textContent = w.toFixed(2);
    document.getElementById('bal_list').innerHTML = curs.map(c=>`<div class="metric"><div>${c}</div><div class="metric-value">${(state.accounts.User_A[c]||0).toFixed(4)}</div></div>`).join('');
    
    ['mint','tx','ai'].forEach(t=>{
        const el = document.getElementById(t+'_hist_short');
        if(el) el.innerHTML = state.hist[t].slice(-5).reverse().map(h=>`<tr><td>${h.time}</td><td>${h.desc}</td><td style="text-align:right;">φ:${h.amt}</td></tr>`).join('');
    });

    document.getElementById('chaos_val').textContent = (state.tension * 100).toFixed(2) + "%";
    document.getElementById('purity_val').textContent = Math.min((w/(phi*10))*100, 100).toFixed(2) + "%";
    
    localStorage.setItem('msgai_v36_sovereign', JSON.stringify(state));
}

// 初期化命令
function resetSystem(){
    if(confirm("システム全体を初期化し、0（原点）に戻します。よろしいですか？")){
        state = initialState();
        document.getElementById('ai-log').innerHTML = "";
        update();
        alert("システムは浄化され、原点に回帰しました。");
    }
}

function resetPart(part){
    if(confirm(`${part} を初期化しますか？`)){
        const fresh = initialState();
        state[part] = fresh[part];
        if(part==='hist') document.getElementById('ai-log').innerHTML = "";
        update();
    }
}

function runMint(){
    const c=document.getElementById('m_cur').value, a=parseFloat(document.getElementById('m_amt').value);
    const z=MSGAI_z(c+a), w=MSGAI_w(z);
    state.accounts.User_A[c] += w; state.tension += (z/10);
    state.hist.mint.push({time:new Date().toLocaleTimeString(), desc:`生成:${c}`, amt:w.toFixed(4)});
    update();
}

function runTx(){
    const c=document.getElementById('tx_cur').value, a=parseFloat(document.getElementById('amt_in').value), r=document.getElementById('rx_in').value;
    const z=MSGAI_z(c+a), w=MSGAI_w(z);
    if(state.accounts.User_A[c]>=w){
        state.accounts.User_A[c]-=w; state.tension+=(z/5);
        state.hist.tx.push({time:new Date().toLocaleTimeString(), desc:`送金:${r}`, amt:w.toFixed(4)});
        update();
    } else { alert("調和不足"); }
}

async function talk(){
    const msg=document.getElementById('ai-in').value; if(!msg) return;
    const z=MSGAI_z(msg), w=MSGAI_w(z);
    document.getElementById('ai-log').innerHTML += `<div>> ${msg} <span style="color:var(--accent); font-size:0.8em;">(w:${w.toFixed(4)})</span></div>`;
    document.getElementById('ai-in').value='';
    state.hist.ai.push({time:new Date().toLocaleTimeString(), desc:msg.substring(0,15), amt:w.toFixed(4)});
    state.tension += z; update();
}

function showFullHist(type){
    const titles = {mint:'全生成履歴', tx:'全移動履歴', ai:'全対話ログ分析'};
    document.getElementById('modal-title').textContent = titles[type];
    document.getElementById('modal-table').innerHTML = [...state.hist[type]].reverse().map(h=>`<tr><td>${h.time}</td><td>${h.desc}</td><td style="text-align:right;">φ:${h.amt}</td></tr>`).join('');
    document.getElementById('modal-overlay').style.display = 'flex';
}

function closeModal(){ document.getElementById('modal-overlay').style.display = 'none'; }
function openTab(n){
    document.querySelectorAll('.tab-pane,.tab-btn').forEach(el=>el.classList.remove('active'));
    document.getElementById(n).classList.add('active');
    document.getElementById('btn-'+n).classList.add('active');
}

document.addEventListener('DOMContentLoaded', ()=>{
    curs.forEach(c=>{
        document.getElementById('m_cur').add(new Option(c,c));
        document.getElementById('tx_cur').add(new Option(c,c));
    });
    update();
});
</script>
</body>
</html>
